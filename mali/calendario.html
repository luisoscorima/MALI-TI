<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario MALI Educaci√≥n</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        /* Estilos generales del contenedor del calendario */
        #calendar-section {
            width: 100%;
            max-width: 900px;
            margin: auto;
            font-family: 'Poppins', sans-serif;
        }
        h2 {
            text-align: center;
        }
        
        /* Contenedor principal del calendario con grid para los d√≠as */
        #calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            padding: 10px;
        }
        
        /* Encabezado de los d√≠as de la semana */
        .day-header {
            font-weight: bold;
            text-align: center;
            padding: 10px;
        }
        
        /* Estilo de cada d√≠a en el calendario */
        .day {
            border: 1px solid #f3f3f3;
            min-height: 100px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            box-sizing: border-box;
            overflow: hidden;
            background: #f3f3f3;
        }
        
        /* N√∫mero del d√≠a en la esquina superior derecha */
        .day-number {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 18px;
            font-weight: normal;
            color: black;
        }
        .day.has-event .day-number {
            color: white;
        }

        /* Contenedor para los eventos del d√≠a */
        .event-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        /* Estilos de cada evento */
        .event {
            flex-grow: 1;
            font-size: 12px;
            color: #fff;
            text-align: center;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        /* Tooltip estilo globo de texto */
        
        .event-tooltip {
            display: none;
            position: absolute;
            background: white;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 15px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            width: 250px;
            max-height: 250px;
            overflow-y: auto;
        }
        .tooltip-header {
            display: flex;
            justify-content:right;
            align-items: right;
        }
        .tooltip-header button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        .tooltip-title {
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>

    <section id="calendar-section">
        <h2>Calendario MALI Educaci√≥n</h2>
        <div id="calendar"></div>
        <div id="tooltip" class="event-tooltip">
            <div class="tooltip-header">
                <button onclick="shareEvent()">‚û§</button>
                <button onclick="addToCalendar()">üîî</button>
                <button onclick="closeTooltip()">X</button>
            </div>
            <span id="tooltip-title"></span>
            <p id="tooltip-datetime"></p>
            <p id="tooltip-description"></p>
        </div>
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const apiKey = "AIzaSyBYX8PghzeYplVqrSDUmNfrYm6jNmz4W4c";
            const calendarId = "gustavo.oscorima@gmail.com";
            
            const calendarDiv = document.getElementById("calendar");
            const tooltip = document.getElementById("tooltip");
            const tooltipTitle = document.getElementById("tooltip-title");
            const tooltipDatetime = document.getElementById("tooltip-datetime");
            const tooltipDescription = document.getElementById("tooltip-description");

            const daysOfWeek = ["Domingo", "Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes", "S√°bado"];
            
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth() + 1;
            
            const firstDayOfMonth = new Date(year, month - 1, 1).toISOString();
            const lastDayOfMonth = new Date(year, month, 0, 23, 59, 59).toISOString();
            
            const colorMapping = {
                "Cursos de Arte": "#F2357B",
                "Extensi√≥n Profesional": "#025E73",
                "Visitas": "#F2B544",
                "Noche MALI": "#52CBD9"
            };
            const defaultColor = "#cccccc";
            
            fetch(`https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events?key=${apiKey}&timeMin=${firstDayOfMonth}&timeMax=${lastDayOfMonth}&singleEvents=true&orderBy=startTime`)
                .then(response => response.json())
                .then(data => {
                    if (!data.items) return;
                    renderCalendar(new Date().getMonth() + 1, new Date().getFullYear(), data.items);
                })
                .catch(error => console.error("Error al cargar eventos:", error));
            
            function getEventColor(description) {
                if (!description) return defaultColor;
                for (let key in colorMapping) {
                    if (description.includes(key)) {
                        return colorMapping[key];
                    }
                }
                return defaultColor;
            }
            
            function renderCalendar(month, year, events) {
                calendarDiv.innerHTML = "";
                const firstDay = new Date(year, month - 1, 1).getDay();
                const lastDate = new Date(year, month, 0).getDate();
                for (let i = 0; i < firstDay; i++) {
                    let emptyCell = document.createElement("div");
                    emptyCell.classList.add("day");
                    calendarDiv.appendChild(emptyCell);
                }
                for (let day = 1; day <= lastDate; day++) {
                    let dayCell = document.createElement("div");
                    dayCell.classList.add("day");
                    let dayNumber = document.createElement("div");
                    dayNumber.classList.add("day-number");
                    dayNumber.textContent = day;
                    dayCell.appendChild(dayNumber);
                    let dayEvents = events.filter(event => new Date(event.start.dateTime || event.start.date).getDate() === day);
                    if (dayEvents.length > 0) {
                        dayCell.classList.add("has-event");
                        let eventContainer = document.createElement("div");
                        eventContainer.classList.add("event-container");
                        dayEvents.forEach(event => {
                            let eventEl = document.createElement("div");
                            eventEl.classList.add("event");
                            eventEl.textContent = event.summary;
                            eventEl.dataset.title = event.summary;
                            eventEl.dataset.datetime = event.start.dateTime || event.start.date;
                            eventEl.dataset.description = event.description || "Sin descripci√≥n";
                            eventEl.style.backgroundColor = Object.keys(colorMapping).find(key => event.description && event.description.includes(key)) ? colorMapping[Object.keys(colorMapping).find(key => event.description.includes(key))] : defaultColor;
                            eventEl.addEventListener("click", function (e) {
                                openTooltip(e, eventEl);
                            });
                            eventContainer.appendChild(eventEl);
                        });
                        dayCell.appendChild(eventContainer);
                    }
                    calendarDiv.appendChild(dayCell);
                }
            }
            function openTooltip(event, element) {
                tooltipTitle.textContent = element.dataset.title;
                tooltipTitle.style.fontWeight = "bold";
                tooltipDatetime.textContent = element.dataset.datetime;
                tooltipDatetime.style.fontSize = "12px";
                tooltipDescription.innerText = element.dataset.description;
                tooltipDescription.style.fontSize = "12px";
                tooltip.style.display = "block";
                tooltip.style.top = `${event.clientY}px`;
                tooltip.style.left = `${event.clientX + 10}px`;
                tooltip.style.scrollbarWidth = "thin";
                tooltip.style.padding = "30px";
            }
            function closeTooltip() {
                const tooltip = document.getElementById("tooltip");
                tooltip.style.display = "none";
            }
        });

    </script>

</body>
</html>
